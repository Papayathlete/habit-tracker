<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>習慣トラッカー</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4" style="max-width: 760px;">
  <h1 class="h3 mb-3">Yes/No 習慣トラッカー</h1>

  {% if request.query_params.get("error") == "bad_habit" %}
  <div class="alert alert-warning">不正な習慣名です。</div>
  {% endif %}

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <div class="text-secondary small mb-2">今日: {{ today }}</div>

      {% for h in habits %}
      <div class="d-flex align-items-center justify-content-between border rounded p-2 mb-2 bg-white">
        <div class="fw-semibold">{{ h }}</div>
        <form method="post" action="/log" class="d-flex gap-2">
          <input type="hidden" name="habit" value="{{ h }}">
          <button class="btn btn-success btn-sm" name="done" value="yes" type="submit">Yes</button>
          <button class="btn btn-outline-danger btn-sm" name="done" value="no" type="submit">No</button>
        </form>
      </div>
      {% endfor %}
      <div class="text-secondary small">※同じ日に押し直すと上書きされます</div>
    </div>
  </div>

  <h2 class="h6 text-secondary mb-2">直近7日</h2>
  <div class="table-responsive">
    <table class="table table-sm table-bordered bg-white">
      <thead>
        <tr>
          <th>日付</th>
          {% for h in habits %}
          <th>{{ h }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for d in days %}
        <tr>
          <td class="text-nowrap">{{ d }}</td>
          {% for h in habits %}
          {% set key = d.isoformat() ~ "::" ~ h %}
          <td class="text-center">
            {% if status.get(key) is sameas true %}
              ✅
            {% elif status.get(key) is sameas false %}
              ❌
            {% else %}
              —
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
</body>
</html>
